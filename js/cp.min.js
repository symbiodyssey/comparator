$(document).ready(function(){cpTable.calculateAllTotals($(".cp-container")),$(".cp-table thead th:first-child").hover(cpTable.menuAddRowAndColumn,cpTable.hideMenu),$(".cp-table thead th:nth-child(n+2)").hover(cpTable.menuAddColumn,cpTable.hideMenu),$(".cp-crit").hover(cpTable.menuAddRow,cpTable.hideMenu),$("#showHTML").click(function(){cpTable.showHTML()}),$(".cp-container").keyup(function(e){var t=$(document.getSelection().anchorNode).parent();if($(t).is(".cp-container thead th ")){var n=$(t).index();n==0?$(".cp-table thead th:nth-child("+(n+1)+")").not(t).text($(t).text()):$(".cp-container thead th:nth-child("+(n+1)+")").not(t).text($(t).text())}else $(t).is(".cp-lbl-weight")?$(".cp-lbl-weight").not(t).text($(t).text()):$(t).is(".cp-lbl-score")?$(".cp-lbl-score").not(t).text($(t).text()):$(t).is(".cp-lbl-total")?$(".cp-lbl-total").not(t).text($(t).text()):($(t).is(".cp-score")||$(t).is(".cp-weight"))&&cpTable.calculateAllTotals(".cp-container")})});var cpTable=function(e){return e.calculateAllTotals=function(t){$(t).find("table").each(function(){e.calculateTableTotals($(this))}),e.calculateGreatTotals(t)},e.calculateTableTotals=function(e){var t=$(e).find("thead tr").children().length-1;for(i=0;i<t;i++)this.calculateTotal(e,i);this.bestOption(e)},e.calculateTotal=function(e,t){var n=0,r=0;$(e).find("tbody tr").each(function(){var e=$(this).find("td.cp-score:eq("+t+")");n+=Number($(e).text()*$(this).find(".cp-weight").text())||0}),$(e).find(".cp-weight").each(function(){r+=Number($(this).text())||0});var i=Math.round(n/(r*100)*100);$(e).find("td.cp-total:eq("+t+")").text(i||0)},e.calculateGreatTotals=function(e){var t=0,n=0,r=$(e).find(".cp-tbl-total thead tr").children().length-1;for(i=0;i<r;i++){t=0,n=0,$(e).find(".cp-table tbody tr").each(function(){var e=$(this).find("td.cp-score:eq("+i+")");t+=Number($(e).text()*$(this).find(".cp-weight").text())||0}),$(e).find(".cp-table .cp-weight").each(function(){n+=Number($(this).text())||0});var s=Math.round(t/(n*100)*100);$(e).find("td.cp-great-total:eq("+i+")").text(s||0)}this.bestGreatTotalOption(e)},e.bestGreatTotalOption=function(e){$(e).find(".cp-great-total").removeClass("cp-best");var t=$(e).find(".cp-great-total:first-child"),n=$(t).index(),r=Number($(t).text())||0,i;$(e).find(".cp-great-total").each(function(){i=Number($(this).text())||0,i>r&&(r=i,n=$(this).index())}),$(e).find(".cp-great-total:nth-child("+(n+1)+")").addClass("cp-best")},e.bestOption=function(e){$(e).find(".cp-total").removeClass("cp-best");var t=$(e).find(".cp-total:first-child"),n=$(t).index(),r=Number($(t).text())||0,i;$(e).find(".cp-total").each(function(){i=Number($(this).text())||0,i>r&&(r=i,n=$(this).index())}),$(e).find(".cp-total:nth-child("+(n+1)+")").addClass("cp-best")},e.showHTML=function(){document.getElementById("htmlcode").value=document.getElementById("comparator").innerHTML},e.addColumn=function(e){var t=$('<th colspan="2">New item</th>');$(".cp-table thead tr th:nth-child("+e+")").after(t),$(".cp-table tbody tr:nth-child(odd) td:nth-child("+e+")").after('<td colspan="2" class="cp-descr">New comment</td>'),$(".cp-table tbody tr:nth-child(even) td:nth-child("+e*2+")").after('<th class="cp-lbl-score">Score :</th><td class="cp-score">0</td>'),$(".cp-table tfoot tr td:nth-child("+(e*2-1)+")").after('<td class="cp-lbl-total">Total :</td><td class="cp-total"></td>'),$(".cp-table thead tr th:nth-child("+(e+1)+")").hover(this.menuAddColumn,this.hideMenu),$(".cp-tbl-total thead tr th:nth-child("+e+")").after("<th>New item</th>"),e==1?$(".cp-tbl-total tbody tr th").after('<td class="cp-great-total"></td>'):$(".cp-tbl-total tbody tr td:nth-child("+e+")").after('<td class="cp-great-total"></td>'),this.calculateAllTotals(".cp-container")},e.addRow=function(e,t){var n=$('<tr><td colspan="2" class="cp-crit">New criterion</td></tr>');$(n).find(".cp-crit").hover(this.menuAddRow,this.hideMenu);var r=$(e).find(" thead tr").children().length-1;if(t<=1){$(e).find("tbody").prepend(n);for(i=0;i<r;i++)$(e).find(" tbody tr:nth-child(1)").append('<td colspan="2" class="cp-descr">New comment</td>');$(e).find("tbody tr:first-child").after('<tr><th class="cp-lbl-weight">Weight :</th><td class="cp-weight">0</td></tr>');for(i=0;i<r;i++)$(e).find(" tbody tr:nth-child(2)").append('<th class="cp-lbl-score">Score :</th><td class="cp-score">0</td>')}else{$(e).find(" tbody tr:nth-child("+(t*2-2)+")").after(n);for(i=0;i<r;i++)$(e).find(" tbody tr:nth-child("+(t*2-1)+")").append('<td colspan="2" class="cp-descr">New comment</td>');$(e).find(" tbody tr:nth-child("+(t*2-1)+")").after('<tr><th class="cp-lbl-weight">Weight :</th><td class="cp-weight">0</td></tr>');for(i=0;i<r;i++)$(e).find(" tbody tr:nth-child("+t*2+")").append('<th class="cp-lbl-score">Score :</th><td class="cp-score">0</td>')}this.calculateAllTotals(".cp-container")},e.removeColumn=function(e){console.log("index:"+e),$(".cp-table thead th:nth-child("+(e+1)+")").remove(),$(".cp-table tbody tr:nth-child(odd) td:nth-child("+(e+1)+")").remove(),$(".cp-table tbody tr:nth-child(even) th:nth-child("+(e*2+1)+")").remove(),$(".cp-table tbody tr:nth-child(even) td:nth-child("+(e*2+1)+")").remove(),$(".cp-table tfoot tr td:nth-child("+e*2+")").remove(),$(".cp-table tfoot tr td:nth-child("+e*2+")").remove(),$(".cp-tbl-total thead th:nth-child("+(e+1)+")").remove(),$(".cp-tbl-total tbody td:nth-child("+(e+1)+")").remove(),this.calculateAllTotals(".cp-container")},e.removeRow=function(e,t){$(e).find("tbody tr:nth-child("+(t*2-1)+")").remove(),$(e).find("tbody tr:nth-child("+(t*2-1)+")").remove(),this.calculateAllTotals(".cp-container")},e.menuAddColumn=function(){$(this).append('<div class="cp-menu"><span onclick="cpTable.addColumn('+($(this).index()+1)+')"><i class="fas fa-plus"></i></span><span onclick="cpTable.removeColumn('+$(this).index()+')"><i class="fas fa-minus"></i></span></div>')},e.menuAddRow=function(t){var t=$(this).closest("table"),n=$('<span><i class="fas fa-plus"></i></span>');console.log("index:"+($(this).parent().index()/2+2));var r=$(this).parent().index()/2+2;$(n).click(function(){e.addRow(t,r)});var i=$('<span><i class="fas fa-minus"></i></span>');$(i).click(function(){e.removeRow(t,r-1)});var s=$('<div class="cp-menu"></div>');$(s).append(n),$(s).append(i),$(this).append(s)},e.menuAddRowAndColumn=function(){var t=$(this).closest("table"),n=$('<span><i class="fas fa-arrow-down"></i></span>');$(n).click(function(){e.addRow(t,1)});var r=$('<span><i class="fas fa-arrow-right"></i></span>');$(r).click(function(){e.addColumn(1)});var i=$('<div class="cp-menu"></div>');$(i).append(n),$(i).append(r),$(this).append(i)},e.hideMenu=function(){$(".cp-menu").remove()},e}(cpTable||{})